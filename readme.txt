# Анализ данных интернет-магазина «В один клик»

## Описание проекта

Интернет-магазин «В один клик» продаёт разные товары: для детей, для дома, мелкую бытовую технику, косметику и даже продукты. Отчёт магазина за прошлый период показал, что активность покупателей начала снижаться. Привлекать новых клиентов уже не так эффективно: о магазине и так знает большая часть целевой аудитории. Возможный выход — удерживать активность постоянных клиентов. Сделать это можно с помощью персонализированных предложений.

«В один клик» — современная компания, поэтому её руководство не хочет принимать решения просто так — только на основе анализа данных и бизнес-моделирования. Она хочет разработать решение, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность.

Руководитель отдела уже сформировал подход к решению поставленной задачи:

1. Нужно промаркировать уровень финансовой активности постоянных покупателей. В компании принято выделять два уровня активности: «снизилась», если клиент стал покупать меньше товаров, и «прежний уровень».

2. Нужно собрать данные по клиентам по следующим группам:
- Признаки, которые описывают коммуникацию сотрудников компании с клиентом.
- Признаки, которые описывают продуктовое поведение покупателя. Например, какие товары покупает и как часто.
- Признаки, которые описывают покупательское поведение клиента. Например, сколько тратил в магазине.
- Признаки, которые описывают поведение покупателя на сайте. Например, как много страниц просматривает и сколько времени проводит на сайте.

3. Нужно построить модель, которая предскажет вероятность снижения покупательской активности клиента в следующие три месяца.

4. В исследование нужно включить дополнительные данные финансового департамента о прибыльности клиента: какой доход каждый покупатель приносил компании за последние три месяца.

5. Используя данные модели и данные о прибыльности клиентов, нужно выделить сегменты покупателей и разработать для них персонализированные предложения.

Осталось лишь реализовать сформулированный подход.

## Загрузка данных

### Датасет `market_file.csv`

Создан датафрейм `market_file`, содержащий в себе данные о поведении покупателя на сайте, о коммуникациях с покупателем и его продуктовом поведении. Он имеет 13 столбцов и 1300 строк.

Столбцы имеют следующий характер:

- `id` — номер покупателя в корпоративной базе данных. Имеет тип `int64`, а значения распределены от 215348 до 216647.
- `Покупательская активность` — рассчитанный класс покупательской активности (целевой признак): `снизилась` или `прежний уровень`. Имеет тип `object` и 2 уникальных значения.
- `Тип сервиса` — уровень сервиса, например `премиум` и `стандарт`. Имеет тип `object` и 3 уникальных значения.
- `Разрешить сообщать` — информация о том, можно ли присылать покупателю дополнительные предложения о товаре. Согласие на это даёт покупатель. Имеет тип `object` и 2 уникальных значения.
- `Маркет_актив_6_мес` — среднемесячное значение маркетинговых коммуникаций компании, которое приходилось на покупателя за последние 6 месяцев. Это значение показывает, какое число рассылок, звонков, показов рекламы и прочего приходилось на клиента. Имеет тип `float64`, а значения распределены от 0.9 до 6.6, при этом среднее — примерно 4.25.
- `Маркет_актив_тек_мес` — количество маркетинговых коммуникаций в текущем месяце. Имеет тип `int64`, а значения распределены от 3 до 5, при этом среднее — примерно 4.
- `Длительность` — значение, которое показывает, сколько дней прошло с момента регистрации покупателя на сайте. Имеет тип `int64`, а значения распределены от 110 до 1079 дней, при этом среднее — примерно 602 дня.
- `Акционные_покупки` — среднемесячная доля покупок по акции от общего числа покупок за последние 6 месяцев. Имеет тип `float64`, а значения распределены от 0 до 0.99, при этом среднее — примерно 0.32.
- `Популярная_категория` — самая популярная категория товаров у покупателя за последние 6 месяцев. Имеет тип `object` и 6 уникальных значений.
- `Средний_просмотр_категорий_за_визит` — показывает, сколько в среднем категорий покупатель просмотрел за визит в течение последнего месяца. Имеет тип `int64`, а значения распределены от 1 до 6 категорий, при этом среднее — примерно 3 категории.
- `Неоплаченные_продукты_штук_квартал` — общее число неоплаченных товаров в корзине за последние 3 месяца. Имеет тип `int64`, а значения распределены от 0 до 10 товаров, при этом среднее — примерно 3 товара.
- `Ошибка_сервиса` — число сбоев, которые коснулись покупателя во время посещения сайта. Имеет тип `int64`, а значения распределены от 0 до 9 сбоев, при этом среднее — примерно 4 сбоя.
- `Страниц_за_визит` — среднее количество страниц, которые просмотрел покупатель за один визит на сайт за последние 3 месяца. Имеет тип `int64`, а значения распределены от 1 до 20 страниц, при этом среднее — примерно 8 страниц.

### Датасет `market_money.csv`

Создан датафрейм `market_money`, содержащий в себе данные о выручке, которую получает магазин с покупателя (то есть сколько покупатель всего потратил за период взаимодействия с сайтом). Он имеет 3 столбца и 3900 строк.

Столбцы:

- `id` — номер покупателя в корпоративной базе данных. Имеет тип `int64`, а значения распределены от 215348 до 216647.
- `Период` — название периода, во время которого зафиксирована выручка. Например, `текущий_месяц` или `предыдущий_месяц`. Имеет тип `object` и 3 уникальных значения.
- `Выручка` — сумма выручки за период. Имеет тип `float64`, а значения распределены от 0 до 106862.2, при этом среднее — примерно 5025.7.

### Датасет `market_time.csv`

Создан датафрейм `market_time`, содержащий в себе данные о времени (в минутах), которое покупатель провёл на сайте в течение периода. Он имеет 3 столбца и 2600 строк.

Столбцы:

- `id` — номер покупателя в корпоративной базе данных. Имеет тип `int64`, а значения распределены от 215348 до 216647.
- `Период` — название периода, во время которого зафиксировано общее время. Имеет тип `object` и 2 уникальных значения.
- `минут` — значение времени, проведённого на сайте, в минутах. Имеет тип `int64`, а значения распределены от 4 до 23 мин, при этом среднее — примерно 13 мин.

### Датасет `money.csv`

Создан датафрейм `money`, содержащий в себе данные о среднемесячной прибыли покупателя за последние 3 месяца (какую прибыль получает магазин от продаж каждому покупателю). Он имеет 2 столбца и 1300 строк.

Столбцы:

- `id` — номер покупателя в корпоративной базе данных. Имеет тип `int64`, а значения распределены от 215348 до 216647.
- `Прибыль` — значение прибыли. Имеет тип `float64`, а значения распределены от 0.86 до 7.43, при этом среднее — примерно 4.

## Предобработка данных

### Переименование столбцов

Названия столбцов датафрейма `market_file` переименованы согласно PEP8. Новые названия столбцов:

- `id` — номер покупателя в корпоративной базе данных;
- `buying_activity` — рассчитанный класс покупательской активности;
- `service_type` — уровень сервиса;
- `allow_reporting` — информация о том, можно ли присылать покупателю дополнительные предложения о товаре;
- `market_active_6_months` — среднемесячное значение маркетинговых коммуникаций компании, которое приходилось на покупателя за последние 6 месяцев;
- `market_active_tech_mes` — количество маркетинговых коммуникаций в текущем месяце;
- `duration` — значение, которое показывает, сколько дней прошло с момента регистрации покупателя на сайте;
- `promotional_purchases` — среднемесячная доля покупок по акции от общего числа покупок за последние 6 месяцев;
- `popular_category` — самая популярная категория товаров у покупателя за последние 6 месяцев;
- `average_category_views_per_visit` — показывает, сколько в среднем категорий покупатель просмотрел за визит в течение последнего месяца;
- `unpaid_products_pieces_quarter` — общее число неоплаченных товаров в корзине за последние 3 месяца;
- `service_error` — число сбоев, которые коснулись покупателя во время посещения сайта;
- `pages_per_visit` — среднее количество страниц, которые просмотрел покупатель за один визит на сайт за последние 3 месяца.

Названия столбцов датафрейма `market_money` переименованы согласно PEP8. Новые названия столбцов:

- `id` — номер покупателя в корпоративной базе данных;
- `period` — название периода, во время которого зафиксирована выручка;
- `revenue` — сумма выручки за период.

Названия столбцов датафрейма `market_time` переименованы согласно PEP8. Новые названия столбцов:

- `id` — номер покупателя в корпоративной базе данных;
- `period` — название периода, во время которого зафиксировано общее время;
- `minutes` — значение времени, проведённого на сайте, в минутах.

Названия столбцов датафрейма `money` переименованы согласно PEP8. Новые названия столбцов:

- `id` — номер покупателя в корпоративной базе данных;
- `profit` — значение прибыли.

### Проверка типов данных

В датафрейме `market_file` все столбцы имеют корректные типы данных. Однако значения столбцов `market_active_6_months`, `promotional_purchases` были переведены из `float64` в `float32` для экономии вычислительной памяти.

В датафрейме `market_money` все столбцы имеют корректные типы данных. Однако значения столбца `revenue` были переведены из `float64` в `float32` для экономии вычислительной памяти.

В датафрейме `market_time` все столбцы имеют корректные типы данных.

В датафрейме `money` все столбцы имеют корректные типы данных. Однако значения столбца `profit` были переведены из `float64` в `float32` для экономии вычислительной памяти.

### Изучение пропущенных значений

В датафреймах `market_file`, `market_money`, `market_time` и `money` пропущенных значений не наблюдается.

### Изучение дубликатов

В столбце `service_type` датафрейма `market_file` были выявлены неявные дубликаты, поэтому их строковые значения были заменены следующим образом: `стандартт` на `стандарт`. Также в столбце `popular_category` исправлена опечатка: `Косметика и аксесуары` на `Косметика и аксессуары`. Еще значения в столбцах `buying_activity` и `popular_category` были приведены к нижнему регистру. При этом было выявлено и удалено 11 явных дубликата по всем столбцам кроме `id`.

В столбце `period` датафрейма `market_money` была найдена опечатка, поэтому строковые значения были заменены следующим образом: `препредыдущий_месяц` на `предпредыдущий_месяц`. При этом неявных и явных дубликатов не обнаружено.

В столбце `period` датафрейма `market_time` была найдена опечатка, поэтому строковые значения были заменены следующим образом: `предыдцщий_месяц` на `предыдущий_месяц`. При этом неявных и явных дубликатов не обнаружено.

В датафрейме `money` неявных и явных дубликатов не обнаружено.

## Исследовательский анализ данных

### Коммуникация с пользователем

Большинство пользователей предпочитают стандартный тип сервиса как при снижении покупательской активности (65.3%, 318 пользователей), так и при её сохранении на прежнем уровне (74.3%, 596 пользователей). Причем снижение покупательской активности приводит к увеличению доли клиентов (на 9%), использующих премиум-сервис.

Большинство пользователей предпочитают включать разрешения на сообщения как при снижении покупательской активности (74.7%, 364 пользователя), так и при её сохранении на прежнем уровне (73.7%, 591 пользователь).

Распределение маркетинга за 6 месяцев более симметрично у пользователей со сниженной покупательской активностью. Обе группы в большинстве своем имеют среднемесячное значение маркетинговых коммуникаций примерно равное 4. При этом у обоих распределений максимальное значение составляет 6.6, а минимальное — 0.9. В предоставленных данных, пользователи с прежним уровнем покупательской активности имеют большее среднемесячное значение маркетинговых коммуникаций (медиана — 4.4) по сравнению с пользователями, у которых активность снизилась (медиана — 3.9). При этом межквартильные размахи у обоих групп пользователей практически совпадают (у сниженного уровня — 1.3, а у прежнего — 1.27), что указывает на примерно одинаковое распределение данных. Также в сниженном уровне покупательской активности наблюдается 2.26% выбросов (в значениях меньше 1 или больше 6), а в прежнем — 0.25% (в значениях меньше 2).

Распределение маркетинга за текущий месяц более симметрично у пользователей со сниженной покупательской активностью. Обе группы в большинстве своем имеют количество маркетинговых коммуникаций равное 4. При этом у обоих распределений максимальное значение составляет 5, а минимальное — 3. В предоставленных данных, пользователи обоих групп имеют одинаковое кол-во маркетинговых коммуникаций (медиана — 4). Межквартильный размах у пользователей с прежним уровнем покупательской активности слишком мал (0), и по этой причине отображается огромная доля выбросов (47.5%). У сниженного же уровня покупательской активности никаких выбросов не наблюдается, а межквартильный размах находится в диапазоне от 4 до 5 маркетинговых коммуникаций.

Распределение длительности истории является многомодальным у обоих групп пользователей и имеет пики примерно в 500 и 800 дней. У пользователей со сниженной покупательской активностью минимальное значение составляет 110 дней, а максимальное — 1079 дней. С прежним уровнем — 121 и 1061 дней соответсвтенно. В предоставленных данных, пользователи со сниженным уровнем покупательской активности зарегистрированы на сайте дольше (медиана — 637 дней) по сравнению с пользователями, у которых активность сохранилась на прежнем уровне (медиана — 590 дней). При этом межквартильный размах для пользователей с прежним уровнем покупательской активности шире (на 54 дня), что указывает на более широкое распределение данных. Выбросов в обоих группах не обнаружено.

### Продуктовое поведение

Товары для детей являются наиболее частой категорией продуктов в заказах для обеих групп пользователей, но их доля выше (на 6.5%) среди пользователей с пониженной покупательской активностью. Косметика, аксессуары и домашний текстиль также популярны среди пользователей с пониженной активностью, но их доли ниже среди пользователей с прежним уровнем покупательской активности (косметика и аксессуары — на 6.7%, домашний текстиль — на 1.9%). Мелкая бытовая техника и электроника значительно более популярна среди пользователей с прежним уровнем покупательской активности по сравнению с пользователями с пониженной (на 13.2%).

Распределение среднего количества просматриваемых категорий продуктов за визит более симметрично у пользователей с прежним уровнем покупательской активности, при этом в большинстве своем они имеют среднее кол-во просматриваемых категорий равное 3 и 4. У сниженного же уровня покупательской активности наиболее частое значение — 2, что значительно меньше. Также у обоих распределений максимальное значение составляет 6, а минимальное — 1. В предоставленных данных, пользователи с прежним уровнем покупательской активности просматривают в 2 раза больше категорий продуктов за визит (медиана — 4) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 2). При этом межквартильный размах для пользователей с прежним уровнем покупательской активности шире (на 1), что указывает на более широкое распределение данных. Также в сниженном уровне покупательской активности наблюдается 8.42% выбросов (в значениях больше или равно 5), а в прежнем — они отсутствуют.

Распределение количества неоплаченных продуктов в корзине за последние 3 месяца более симметрично у пользователей со сниженным уровнем покупательской активности, при этом в большинстве своем они имеют кол-во неоплаченных продуктов в размере от 2 до 5. У прежнего же уровня покупательской активности наиболее частое значение — 1, что значительно меньше. Также у обоих распределений минимальные значения совпадают (в значении 0), а максимальные расходятся (у сниженного уровня — 10, а у прежнего — 8). В предоставленных данных, пользователи с прежним уровнем покупательской активности имеют в 2 раза меньше неоплаченных продуктов в корзине (медиана — 2) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 4). При этом межквартильный размах для пользователей со сниженным уровнем покупательской активности шире (на 1), что указывает на более широкое распределение данных. Также в сниженном уровне покупательской активности наблюдается 0.82% выбросов (в значениях больше или равно 10), а в прежнем — 0.37% (в значениях больше или равно 7).

### Финансовое поведение

Распределение разницы в выручке предыдущего и предпредыдущего месяца более симметрично у пользователей со сниженным уровнем покупательской активности, при этом в большинстве своем они имеют разницу в выручке в размере примерно 428. У прежнего же уровня покупательской активности наиболее частое значение — примерно 214, что значительно меньше. Также у обоих распределений минимальные значения совпадают 0, а максимальные расходятся (у сниженного уровня — 2067, а у прежнего — 1999). В предоставленных данных, пользователи с прежним уровнем покупательской активности имеют меньшую разницу в выручке (медиана — 392.5) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 657). При этом межквартильный размах для пользователей со сниженным уровнем покупательской активности шире (на 145.63), что указывает на более широкое распределение данных. Также в сниженном уровне покупательской активности наблюдается 0.2% выбросов (в значениях больше 2000), а в прежнем — 0.37% (в значениях больше или равно 1500).

Распределение разницы в выручке текущего и предыдущего месяца более симметрично у пользователей со сниженным уровнем покупательской активности, при этом в большинстве своем они имеют разницу в выручке в размере примерно 250. У прежнего же уровня покупательской активности наиболее частое значение — примерно 167, что значительно меньше. Также у обоих распределений минимальные (у сниженного уровня — 1.3, а у прежнего — 0) и максимальные (у сниженного уровня — 5986.3, а у прежнего — 1446.9) значения не совпадают. В предоставленных данных, обе группы пользователей имеют примерно одинаковые разницы в выручке текущего и предыдущего месяца (медиана у сниженного уровня — 388.7, а у прежнего — 373.1). При этом межквартильный размах для пользователей с прежним уровнем покупательской активности шире (на 57.2), что указывает на более широкое распределение данных. Также в сниженном уровне покупательской активности было удалено одно аномальное значение (100785.2), причем после удаления наблюдается 1.65% выбросов (в значениях больше 1300). В прежнем же уровне — 0.25% выбросов (в значениях больше 1400).

Распределение выручки за текущий месяц более симметрично у пользователей с прежним уровнем покупательской активности, при этом в большинстве своем они имеют выручку в размере примерно 5000. У сниженного же уровня покупательской активности наиболее частое значение — примерно 5333. Также у обоих распределений минимальные (у сниженного уровня — 2758.7, а у прежнего — 2952.2) и максимальные (у сниженного уровня — 7799.4, а у прежнего — 7547.8) значения не совпадают. В предоставленных данных, пользователи с прежним уровнем покупательской активности имеют меньшую выручку (медиана — 5122.55) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 5296.7). При этом межквартильный размах для пользователей со сниженным уровнем покупательской активности шире (на 436.25), что указывает на более широкое распределение данных. Также в сниженном уровне покупательской активности выбросов не обнаружилось, а в прежнем — 4.11% выбросов (в значениях меньше 3500 или больше 6800).

### Поведение на сайте

Распределение времени, проведенного на сайте за предыдущий месяц, более равномерно у пользователей со сниженным уровнем покупательской активности, при этом в большинстве своем они имеют время примерно равное 10 мин. У прежнего же уровня покупательской активности наиболее частое значение — примерно 15 мин. Также у обоих распределений минимальные значения не совпадают (у сниженного уровня — 5 мин, а у прежнего — 7 мин), а максимальные наоборот — совпадают (23 мин). В предоставленных данных, пользователи с прежним уровнем покупательской активности в прошлом месяце провели больше времени за сайтом (медиана — 15 мин) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 10 мин). При этом межквартильные размахи пользователей обоих групп совпадают (5 мин), что указывает на примерно одинаковое распределение данных. Также в прежнем уровне покупательской активности выбросов не обнаружилось, а в сниженном — 1.44% выбросов (в значениях больше 20 мин).

Распределение времени, проведенного на сайте за текущий месяц, более равномерно у пользователей со сниженным уровнем покупательской активности, при этом в большинстве своем они имеют время примерно равное от 8 до 11 мин. У прежнего же уровня покупательской активности наиболее частое значение — примерно 15 мин. Также у обоих распределений минимальные значения совпадают (4 мин), а максимальные наоборот — не совпадают (у сниженного уровня — 22 мин, а у прежнего — 23 мин). В предоставленных данных, пользователи с прежним уровнем покупательской активности в текущем месяце провели больше времени за сайтом (медиана — 15 мин) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 10 мин). При этом межквартильный размах для пользователей с прежним уровнем покупательской активности шире (на 2 мин), что указывает на более широкое распределение данных. Также в прежнем уровне покупательской активности выбросов не обнаружилось, а в сниженном — 2.46% выбросов (в значениях больше или равно 20 мин).

Распределение количества просматриваемых страниц за визит более симметрично у пользователей с прежним уровнем покупательской активности, при этом в большинстве своем они просматривают 10 страниц. У сниженного же уровня покупательской активности наиболее частое значение — 3-4 страницы, что значительно ниже. Также у обоих распределений минимальные (у сниженного уровня — 1 стр., а у прежнего — 3 стр.) и максимальные (у сниженного уровня — 18 стр., а у прежнего — 20 стр.) значения не совпадают. В предоставленных данных, пользователи с прежним уровнем покупательской активности просматривают в 2 раза больше страниц (медиана — 10 стр.) по сравнению с пользователями, у которых покупательская активность снизилась (медиана — 5 стр.). При этом межквартильный размах для пользователей с прежним уровнем покупательской активности шире (на 1 стр.), что указывает на более широкое распределение данных. Также в сниженном уровне покупательской активности наблюдается 3.9% выбросов (в значениях больше или равно 14 стр.), а в прежнем — 0.25% (в значениях больше или равно 20 стр.).

Распределение количества сбоев сайта более симметрично у пользователей с прежним уровнем покупательской активности, при этом в большинстве своем они имеют 4 сбоя. У сниженного же уровня покупательской активности наиболее частое значение — 3 сбоя. Также у обоих распределений минимальные значения не совпадают (у сниженного уровня — 1 сбой, а у прежнего — 0 сбоев), а максимальные наоборот — совпадают (9 сбоев). В предоставленных данных, пользователи обоих групп имеют одинаковое количество сбоев сайта (медиана — 4 сбоя). И их межквартильные размахи тоже совпадают (3 сбоя), что указывает на примерно одинаковое распределение данных. Также выбросов в обоих группах не замечено.

### Отбор пользователей с покупательской активностью не менее трех месяцев

Во всех датафреймах были удалены пользователи (`id`: 215348, 215357, 215359), которые за последние 3 месяца хотя бы в одном месяце не принесли выручку.

### Покупательская активность

В значениях покупательской активности наблюдается небольшой дисбаланс. Доля пользователей с прежним уровнем покупательской активности составляет 62.4% (802 пользователя), а со сниженным уровнем — 37.6% (484 пользователя). В свою очередь это может отразиться на обучении модели машинного обучения и её метриках качества.

## Объединение данных

Было произведено объединение датафреймов `market_file` (1286, 13), `market_money_pivot` (1296, 4) и `market_time_pivot` (1297, 3) в один датафрейм `market` (1285, 18).

## Корреляционный анализ

### Анализ с помощью коэффициента $\phi_k$

Согласно коэффициенту $\phi_k$, в датафрейме `market` наблюдаются следующие сильные корреляции:

- между целевым признаком `buying_activity` и: `pages_per_visit` (0.8), `previous_month_time` (0.7);
- между входными признаками: `current_month_revenue` и `previous_month_revenue` (0.8).

Очень высоких корреляций (> 0.9) между входными признаками не наблюдается, скорее всего мультиколлинеарности нет.

Также никаких сильных новых корреляций для каждой категории целевого признака `buying_activity` не выявлено.

### Анализ с помощью диаграмм рассеяния

Наблюдается явная линейная зависимость между выручками за текущий и прошлый месяцы. Также замечена довольно значительная часть пользователей, которые за последние полгода большую часть покупок совершали по акции, причем у средних `id` отсутствует такое поведение.

Наблюдается сильная линейная зависимость между выручками у пользователей со сниженной покупательской активностью, с премиум-сервисом и с популярной категорией "товары для детей".

Большинство пользователей, которые за последние полгода чаще всего совершали покупки по акциям, отличаются сниженной покупательской активностью, используют стандартный сервис и разрешают получать сообщения.

## Построение модели машинного обучения

### Выбор признаков

В качестве целевого признака был выбран столбец `buying_activity`, а в качестве входных — остальные столбцы из датафрейма `market`, кроме `id`. Также было произведено кодирование (label encoder) целевого признака (прежний уровень покупательской активности обозначается как `0`, а сниженный — как `1`). Затем данные были разделены на тренировочную (75%) и тестовую выборки (25%) с применением стратификации.

### Пайплайны

Для подготовки данных были выбраны следующие методы:

- кодирование: `OneHotEncoder()`;
- масштабирование: `StandardScaler()`, `MinMaxScaler()` и `RobustScaler()`.

Для задачи классификации было выбрано 4 модели машинного обучения:

- `KNeighborsClassifier()` — метод k-ближайших соседей с гиперпараметрами: кол-во соседей от 2 до 10 и манхеттанское, евклидово расстояния;
- `DecisionTreeClassifier()` — дерево решений с гиперпараметрами: максимальная глубина дерева от 2 до 10, минимальное кол-во объектов в узле от 2 до 10 и минимальное кол-во объектов в листе от 1 до 10;
- `SVC()` — метод опорных векторов с гиперпараметрами: сила регуляризации от 1 до 10 и линейное, радиальная базисная функция, сигмоидное, полиномиальное ядра;
- `LogisticRegression()` — логистическая регрессия с l1-регуляризацией с гиперпараметром сила регуляризации от 1 до 10.

### Кросс-валидация

Для оценки качества модели была выбрана метрика `ROC-AUC`, так как она не зависит от порога классификации, учитывает как `True Positive Rate`, так и `False Positive Rate`, что делает её более устойчивой к дисбалансу классов по сравнению с метриками, такими как `accuracy`.

При случайной кросс-валидации лучшей моделью оказалось логистическая регрессия с l1-регуляризацией и гиперпараметром `C` равным 9. Причем категориальные данные подготавливались с помощью кодировщиков `OneHotEncoding()` (`service_type` и `allow_reporting`) и `OrdinalEncoder()` (`popular_category`), а численные остались неизменными. Значение `ROC-AUC` лучшей модели на валидационных данных составляет 0.9, а на тестовых — 0.92.

### Анализ модели

Матрица ошибок лучшей модели имеет следующий вид:

- 191 пользователь с прежним уровнем покупательской активности были верно классифицированы (TN),
- 23 пользователя со сниженным уровнем покупательской активности были неверно классифицированы (FN),
- 98 пользователей со сниженным уровнем покупательской активности были верно классифицированы (TP),
- 10 пользователей с прежним уровнем покупательской активности был неверно классифицирован (FP).

Доля верных прогнозов на тестовой выборке составляет 90% (accuracy), причем стоит учесть, что в предоставленных данных пользователей с прежним уровнем покупательской активности на 24.8% больше, чем со сниженным уровнем. Точность же, с которой модель присваивает пользователям категорию `снизилась` составляет 91% (precision). Причем 81% (recall) пользователей категории `прежний уровень` модель смогла правильно идентифицировать среди всех пользователей категории `прежний уровень`.

### Графики важности SHAP

С точки зрения модели и согласно графику важности SHAP в виде плотбара, входные признаки можно разделить на:

- **значимые**: среднее кол-во просмотренных страниц за визит (0.62), проведенное время на сайте за разные периоды (предыдущий месяц — 0.58, текущий месяц — 0.38), среднее количество просматриваемых категорий продуктов за визит (0.47), кол-во неоплаченных продуктов в корзине (0.45), среднемесячная доля покупок по акции от общего числа покупок (0.42);
- **малозначимые**: среднемесячное значение маркетинговых коммуникаций (0.32), выручки за разные периоды (предпредыдущий месяц — 0.2, предыдущий месяц — 0.28, текущий месяц — 0.25), популярная категория (мелкая бытовая техника и электроника - 0.28, техника для красоты и здоровья - 0.17, товары для детей - 0.13, косметика и аксессуары - 0.05, кухонная посуда - 0.01);
- **незначимые**: длительность истории с клиентом (0.09), число сбоев сайта (0.05), кол-во маркетинговых коммуникаций в текущем месяце (0.03), разрешения на сообщения (0.02), тип сервиса (0).

Также согласно графику важности SHAP в виде beeswarm, модель говорит о том, что высокие значения среднего кол-ва просмотренных страниц за визит, проведенного времени на сайте за разные периоды, среднего количества просматриваемых категорий продуктов за визит и низкие значения кол-ва неоплаченных продуктов в корзине, среднемесячной доли покупок по акции от общего числа покупок влияют на определение прежнего уровня покупательской активности.

Следовательно, интернет-магазину «В один клик» следует обращать внимание на низкие значения среднего кол-ва просмотренных страниц за визит, проведенного времени на сайте за разные периоды, среднего количества просматриваемых категорий продуктов за визит и высокие значения кол-ва неоплаченных продуктов в корзине, среднемесячной доли покупок по акции от общего числа покупок, так как все они, с точки зрения модели, значительно влияют на определение сниженного уровня покупательской активности.

## Сегментация пользователей

### Объединение данных с результатами модели машинного обучения

Было произведено объединение данных с вероятностями принадлежности к сниженному уровню покупательской активности в один датафрейм `new_market` (1285, 20).

### Первый cегмент пользователей

Согласно диаграмме рассеяния, отображающей зависимость между вероятностью снижения покупательской активности и средним кол-вом просмотренных страниц за визит, можно выделить 371 пользователя, у которых вероятность снижения покупательской активности больше 60% и среднее кол-во просмотренных страниц за визит меньше 7.5. Среднее значение прибыли данного сегмента составляет примерно 4.03.

### Второй cегмент пользователей

Согласно диаграмме рассеяния, отображающей зависимость между вероятностью снижения покупательской активности и средним временем, проведенным на сайте, можно выделить 182 пользователя, у которых вероятность снижения покупательской активности больше 60% и среднее время, проведенное на сайте, меньше 10 мин. Среднее значение прибыли данного сегмента составляет примерно 4.01.

### Третий cегмент пользователей

Согласно диаграмме рассеяния, отображающей зависимость между вероятностью снижения покупательской активности и средним кол-вом просматриваемых категорий продуктов за визит можно выделить 221 пользователя, у которых вероятность снижения покупательской активности больше 60% и среднее кол-во просматриваемых категорий продуктов за визит меньше 3. Среднее значение прибыли данного сегмента составляет примерно 4.06.

### Четвертый cегмент пользователей

Согласно диаграмме рассеяния, отображающей зависимость между вероятностью снижения покупательской активности и кол-вом неоплаченных продуктов в корзине можно выделить 168 пользователей, у которых вероятность снижения покупательской активности больше 60% и кол-во неоплаченных продуктов в корзине больше 4. Среднее значение прибыли данного сегмента составляет примерно 4.

### Пятый cегмент пользователей

Согласно диаграмме рассеяния, отображающей зависимость между вероятностью снижения покупательской активности и среднемесячной долей покупок по акции от общего числа покупок можно выделить 133 пользователя, у которых вероятность снижения покупательской активности больше 60% и среднемесячная доля покупок по акции от общего числа покупок больше 0.6. Среднее значение прибыли данного сегмента составляет примерно 3.9.

### Графическое и аналитическое исследование 5-го сегмента пользователей

У пятого сегмента пользователей наблюдается высокая вероятность снижения покупательской активности, так как среднее значение составляет примерно 0.93, а медиана — 0.97. Также среднее значение прибыли, по сравнению с остальными проблемными сегментами пользователей, значительно снижено и составляет примерно 3.9.

При этом пятый сегмент пользователей заметно отстает от других пользователей в следующих моментах:

- по среднему количеству страниц, которые просмотрел покупатель за один визит на сайт за последние 3 месяца (в 2 раза);
- по выручке за предпредыдущий месяц.

В пятом сегменте наблюдается больше премиум-пользователей — на 6.3%.

У всех пользователей и пятого сегмента примерно одинаковые соотношения разрешений на сообщения.

В пятом сегменте пользователей, которые интересуются детскими товарами, больше на 9.2%. И также на 5.1% больше пользователей, которые ищут кухонную посуду.

В пятом сегменте за предыдущий и текущий месяцы меньше средней выручки от стандартных пользователей.

В пятом сегменте за предыдущий и текущий месяцы меньше средней выручки от пользователей с разрешением на сообщения.

В пятом сегменте за предыдущий и текущий месяцы меньше средней выручки от продажи товаров для красоты и здоровья, чем от других товаров.